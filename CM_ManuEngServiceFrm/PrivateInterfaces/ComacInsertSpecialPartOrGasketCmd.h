//===================================================================
// COPYRIGHT  2020/09/27
//===================================================================
// ComacInsertSpecialPartOrGasketCmd.cpp
// Header definition of class ComacInsertSpecialPartOrGasketCmd
//===================================================================
//
// Usage notes:
//
//===================================================================
//  2020/09/27 Creation: Code generated by the 3DS wizard
//===================================================================

#ifndef ComacInsertSpecialPartOrGasketCmd_H
#define ComacInsertSpecialPartOrGasketCmd_H

#include "ProcessPlanningService.h"
#include "CATStateCommand.h"

#include "ComacInsertSpecialPartOrGasketDlg.h"
#include "CATPathElementAgent.h"

//CATPLMComponentInterfaces 
#include "CATIPLMNavReference.h"
#include "CATIPLMNavOccurrence.h"
#include "CATIPLMNavRepInstance.h"
#include "CATIPLMNavInstance.h"
#include "CATIPLMNavRepInstance.h"
#include "CATIPLMNavReference.h"
#include "CATIPLMNavEntity.h"
#include "CATListPtrCATIPLMNavEntity.h"

// CAT3DPhysicalRepInterfaces Framework
#include "CATIPsiRepresentationLoadMode.h"

#include "CATSysBoolean.h"
#include "CATDialogAgent.h"

//VisualizationInterfaces 
#include "CATPathElement.h"



#include "iostream.h"
#include "CATListPtrCATIAdpPLMIdentificator.h"
#include "CATListPtrCATIPLMNavReference.h"

// 添加包
// ObjectModelerBase Framework
#include "CATOmbLifeCycleRootsBag.h"

// KnowledgeInterfaces Framework
#include "CATITypeDictionary.h"
//CATPLMIntegrationAccess
#include "CATAdpAttributeSet.h"

//MecModInterfaces Framework
#include "CATIMmiPrtContainer.h"
#include "CATIMmiMechanicalFeature.h"


//CATPLMIdentificationAccess Framework
#include "CATPLMCoreType.h"

//ObjectSpecsModeler Framework
#include "CATIPartRequest.h"

// CATPLMComponentInterfaces Framework
#include "CATIPLMNavInstance.h"
#include "CATIPLMNavRepInstance.h"
#include "CATIPLMNavReference.h"
#include "CATIPLMNavRepReference.h"
#include "CATIPLMNavEntity.h"
#include "CATListPtrCATIPLMNavEntity.h"

// CAT3DPhysicalRepInterfaces Framework
#include "CATIPsiRepresentationLoadMode.h"

// System Framework
#include "CATBaseUnknown.h"
#include "CATUnicodeString.h"

// others
#include "iostream.h"
//MecModInterfaces Framework
#include "CATIPartRequest.h"

#include "CATIMmiUseBodyContent.h"
#include "CATIAlias.h"      // to retrieve a specific body 

#include "CATLISTV_CATBaseUnknown.h" 
#include "CATIMmiUsePrtPart.h" 


//System Framewrks
#include "CATBoolean.h"
#include "CATUnicodeString.h"
#include "iostream.h"

//-----------------------------------------------------------------------

#define _RETURN_IF_FAILED_(hr, message) \
	if (FAILED(hr)) \
		{ cout << "=== FAILED ===> " << message << endl; return 1; } else	{	cout << "=== OK ===> " << message << endl; }

#define _RETURN_IF_TRUE_(ret, message) \
	if (ret) \
		{ cout << "=== FAILED ===> " << message << endl; return ret; } else	{	cout << "=== OK ===> " << message << endl; }



class ComacInsertSpecialPartOrGasketCmd : public CATStateCommand
{
	DeclareResource(ComacInsertSpecialPartOrGasketCmd, CATStateCommand)
public:
	// Standard constructors and destructors
	// -------------------------------------
	ComacInsertSpecialPartOrGasketCmd();
	virtual ~ComacInsertSpecialPartOrGasketCmd();

	//
	// TODO: Add your methods for this class here.
	virtual CATBoolean  ActionOne(void * data);

	virtual CATBoolean OKAction(void *data);

	virtual CATBoolean ApplyAction(void *data);

	virtual CATBoolean CancelAction(void *data);

	CATBoolean ElementSelection(void * data);

	void BuildGraph();


	// ******************** 几个包 *********************
	
	int FindReference(CATOmbLifeCycleRootsBag & iLifeCycleBag,
		const CATAdpAttributeSet & iAttributeSet,
		CATIType * ipModelerType,
		const IID & iIID,
		void ** oppReference);

	void ReleasePtr(CATBaseUnknown * piCBU);

	HRESULT GetOccurrenceFromProcessReference(const CATIPLMNavReference_var & ihNavRef, CATIPLMNavOccurrence_var & ohNavOcc);


	// 自行添加 module 一直 KO! 没办法 只能添加在函数内部！
	HRESULT CAAMmrGetPartFromProduct(CATIPLMNavInstance_var   spNavInstance, CATIPartRequest_var  & ospPartFromProduct);

	HRESULT CAAMmrGetGeometry(CATIPartRequest_var ispModelPart, const CATUnicodeString iInputName,
		CATBaseUnknown ** oInput);


	// 解决 BU toRef fengy 2021.11.18
	CATIPLMNavReference_var  FromBUToRef(CATBaseUnknown * ipNewProdRef);

	void DeleteFeature(CATBaseUnknown_var spObj);
	void UpdateFeature(CATBaseUnknown_var spObj);


	// ******************** 几个包 *********************

	CATBoolean CheckSelectObject();

	void FilterSelectObject();

	// fengy 2021.12.22 插入动作 Run
	void InsertSpOrGasket();

private:
	// Copy constructor and equal operator
	// -----------------------------------
	ComacInsertSpecialPartOrGasketCmd(ComacInsertSpecialPartOrGasketCmd &);
	ComacInsertSpecialPartOrGasketCmd& operator=(ComacInsertSpecialPartOrGasketCmd&);

	ComacInsertSpecialPartOrGasketDlg *_Panel;

	//CATUnicodeString iManuPartType;
	CATUnicodeString sPartExternalId;

	CATDialogAgent *_OKAgent;
	CATDialogAgent *_ApplyAgent;
	CATDialogAgent *_CancleAgent;
	CATDialogAgent *_CloseAgent;
	CATPathElementAgent *_pSelectAgent;

	//CATDlgRadioButton *_pRadioBtnCopy;
	//CATDlgRadioButton *_pRadioBtnInput;

	CATBaseUnknown        * _pSelectedElement;
	CATIPLMNavOccurrence  * _pSelectedOccurrence;
	CATIPLMNavRepInstance * _pSelectedRepInstance;
	CATIPLMNavReference   * _pSelectedReference;

	//CATIPLMNavReference *pProvidePartRef;
	//CATIPLMNavOccurrence *pProvidePartOcc;


	CATIPLMNavReference *pMARootRef;
	CATIPLMNavOccurrence *pMARootOcc;

	CATIPLMNavReference *pMAFatherRef;
	CATIPLMNavOccurrence *pMAFatherOcc;

	//CATIPLMNavReference *pProductRef;				// cad
	//CATIPLMNavOccurrence *pProductOcc;
	//CATIPLMNavInstance *pProductInstance;

	//CATUnicodeString	 _strMAExternal_ID;

	CATUnicodeString _sPartNo  ;
	CATUnicodeString _sPartName;

};

//-----------------------------------------------------------------------

#endif
